

<div class="layui-fluid">

  <div class="layui-row layui-col-space15">

    <div class="layui-col-md12">

      <div class="layui-row layui-col-space15">

        <div class="layui-col-md12">





          <div class="layui-card">

            <div class="layui-tab layui-tab-brief layadmin-latestData">

              <ul class="layui-tab-title">

                <li class="layui-this">登录信息</li>

                <li>地址信息</li>

                <li>用户信息</li>

              </ul>

              <div class="layui-tab-content">

                <div class="layui-tab-item layui-show">

                  <table id="LAY-index-topSearch"></table>

                </div>

                

                <div class="layui-tab-item">

                  <table id="LAY-index-topCard"></table>

                </div>



                <div class="layui-tab-item">

                  <table id="LAY-index-topCard-user"></table>

                </div>



              </div>

            </div>

          </div>











        </div>









        <div class="layui-col-md6">

          <div class="layui-card">

            <div class="layui-card-header">快捷方式</div>

            <div class="layui-card-body">

              

              <div class="layui-carousel layadmin-carousel layadmin-shortcut">

                <div carousel-item>

                  <ul class="layui-row layui-col-space10">

                    <li class="layui-col-xs3">

                      <a lay-href="component/layer/list">

                        <i class="layui-icon layui-icon-website"></i>

                        <cite>弹层</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="component/button/">

                        <i class="layui-icon layui-icon-find-fill"></i>

                        <cite>按钮</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="component/progress/">

                        <i class="layui-icon layui-icon-loading-2"></i>

                        <cite>进度条</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="component/grid/speed-dial">

                        <i class="layui-icon layui-icon-home"></i>

                        <cite>临时图标</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="component/panel/">

                        <i class="layui-icon layui-icon-read"></i>

                        <cite>面板</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="component/badge/">

                        <i class="layui-icon layui-icon-tree"></i>

                        <cite>徽章</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="component/timeline/">

                        <i class="layui-icon layui-icon-console"></i>

                        <cite>时间线</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="component/auxiliar/">

                        <i class="layui-icon layui-icon-survey"></i>

                        <cite>辅助</cite>

                      </a>

                    </li>

                  </ul>

                  <ul class="layui-row layui-col-space10">

                    <li class="layui-col-xs3">

                      <a lay-href="set/base/website">

                        <i class="layui-icon layui-icon-set"></i>

                        <cite>设置</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="set/base/website">

                        <i class="layui-icon layui-icon-set"></i>

                        <cite>设置</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="set/base/website">

                        <i class="layui-icon layui-icon-set"></i>

                        <cite>设置</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="set/base/website">

                        <i class="layui-icon layui-icon-set"></i>

                        <cite>设置</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="set/base/website">

                        <i class="layui-icon layui-icon-set"></i>

                        <cite>设置</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="set/base/website">

                        <i class="layui-icon layui-icon-set"></i>

                        <cite>设置</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="set/base/website">

                        <i class="layui-icon layui-icon-set"></i>

                        <cite>设置</cite>

                      </a>

                    </li>

                    <li class="layui-col-xs3">

                      <a lay-href="set/base/website">

                        <i class="layui-icon layui-icon-set"></i>

                        <cite>设置</cite>

                      </a>

                    </li>

                  </ul>

                  

                </div>

              </div>

              

            </div>

          </div>









<!--           <div class="layui-card">

            <div class="layui-card-header">地址信息</div>

            <div class="layui-card-body">

              

              <div class="layui-carousel layadmin-carousel layadmin-dataview" data-anim="fade" lay-filter="LAY-index-dataview">

                <div carousel-item id="LAY-index-dataview">

                  <div><i class="layui-icon layui-icon-loading1 layadmin-loading"></i></div>

                  <div></div>

                  <div></div>

                </div>

              </div>

              

            </div>

          </div>

 -->





          

        </div>

        <div class="layui-col-md6">

          <div class="layui-card">

            <div class="layui-card-header">待办事项</div>

            <div class="layui-card-body">



              <div class="layui-carousel layadmin-carousel layadmin-backlog">

                <div carousel-item>

                  <ul class="layui-row layui-col-space10">

                    <li class="layui-col-xs6">

                      <a lay-href="" class="layadmin-backlog-body">

                        <h3>待审评论</h3>

                        <p><cite>66</cite></p>

                      </a>

                    </li>

                    <li class="layui-col-xs6">

                      <a lay-href="" class="layadmin-backlog-body">

                        <h3>待审帖子</h3>

                        <p><cite>12</cite></p>

                      </a>

                    </li>

                    <li class="layui-col-xs6">

                      <a lay-href="" class="layadmin-backlog-body">

                        <h3>待审商品</h3>

                        <p><cite>99</cite></p>

                      </a>

                    </li>

                    <li class="layui-col-xs6">

                      <a lay-href="" class="layadmin-backlog-body">

                        <h3>待发货</h3>

                        <p><cite>20</cite></p>

                      </a>

                    </li>

                  </ul>

                  <ul class="layui-row layui-col-space10">

                    <li class="layui-col-xs6">

                      <a lay-href="" class="layadmin-backlog-body">

                        <h3>待审友情链接</h3>

                        <p><cite style="color: #FF5722;">5</cite></p>

                      </a>

                    </li>

                  </ul>

                </div>

              </div>

            </div>

          </div>

        </div>



      </div>

    </div>

    



    

  </div>

</div>









<script>

//加载 controller 目录下的对应模块

/*



  小贴士：

    这里 console 模块对应 的 console.js 并不会重复加载，

    然而该页面的视图则是重新插入到容器，那如何保证能重新来控制视图？有两种方式：

      1): 借助 layui.factory 方法获取 console 模块的工厂（回调函数）给 layui.use

      2): 直接在 layui.use 方法的回调中书写业务代码，即:

          layui.use('console', function(){ 

            //同 console.js 中的 layui.define 回调中的代码 

          });

          

  这里我们采用的是方式1。其它很多视图中采用的其实都是方式2，因为更简单些，也减少了一个请求数。

  

*/



layui.use(['admin', 'layim'], function(){

  var $ = layui.$

  ,admin = layui.admin

  ,element = layui.element

  ,router = layui.router();

  layim = layui.layim;

  
  //基础配置
  layim.config({
    //初始化接口

    init: {
      url: '/im/im/GetUserInfo' //接口地址（返回的数据格式见下文）
      ,type: 'get' //默认get，一般可不填
      ,data: {access_token: layui.data('layuiAdmin').access_token} //额外参数
    } //获取主面板列表信息，下文会做进一步介绍


    //获取群员接口（返回的数据格式见下文）
    ,members: {
      url: '/im/im/getMembers' //接口地址（返回的数据格式见下文）
      ,type: 'get' //默认get，一般可不填
      ,data: {access_token: layui.data('layuiAdmin').access_token} //额外参数
    }
    
    ,uploadImage: {
      url: '' //（返回的数据格式见下文）
      ,type: '' //默认post
    }
    ,uploadFile: {
      url: '' //（返回的数据格式见下文）
      ,type: '' //默认post
    }
    
    ,isAudio: true //开启聊天工具栏音频
    ,isVideo: true //开启聊天工具栏视频
    
    //扩展工具栏
    ,tool: [{
      alias: 'code'
      ,title: '代码'
      ,icon: '&#xe64e;'
    }]
    
    //,brief: true //是否简约模式（若开启则不显示主面板）
    
    //,title: 'WebIM' //自定义主面板最小化时的标题
    //,right: '100px' //主面板相对浏览器右侧距离
    //,minRight: '90px' //聊天面板最小化时相对浏览器右侧距离
    ,initSkin: '3.jpg' //1-5 设置初始背景
    //,skin: ['aaa.jpg'] //新增皮肤
    //,isfriend: false //是否开启好友
    //,isgroup: false //是否开启群组
    //,min: true //是否始终最小化主面板，默认false
    //,notice: true //是否开启桌面消息提醒，默认false
    //,voice: false //声音提醒，默认开启，声音文件为：default.mp3
    
    ,msgbox: '/layim/demo/msgbox.html' //消息盒子页面地址，若不开启，剔除该项即可
    ,find: '/layim/demo/find.html' //发现页面地址，若不开启，剔除该项即可
    ,chatLog: '/layim/demo/chatlog.html' //聊天记录页面地址，若不开启，剔除该项即可
    
  });


layim.on('sendMessage', function(res){

  console.log(res); 

    var mine = res.mine; //包含我发送的消息及我的信息

    var to = res.to; //对方的信息
    //请求

    admin.req({
      url: '/im/im/sendMessage' //实际使用请改成服务端真实接口
      ,data: {
        mine: JSON.stringify(mine),//包含我发送的消息及我的信息
        to:JSON.stringify(to) //对方的信息
      }
      ,done: function(res){        
        // layer.msg('验证码已成功发送至您的手机', {
        //   offset: '15px'
        //   ,icon: 1
        //   ,time: 3000
        // });
      }

    });


// layim.getMessage({

//   username: "纸飞机" //消息来源用户名

//   ,avatar: "http://tp1.sinaimg.cn/1571889140/180/40030060651/1" //消息来源用户头像

//   ,id: "100000" //消息的来源ID（如果是私聊，则是用户id，如果是群聊，则是群组id）

//   ,type: "friend" //聊天窗口来源类型，从发送消息传递的to里面获取

//   ,content: "嗨，你好！本消息系离线消息。" //消息内容

//   ,cid: 0 //消息id，可不传。除非你要对消息进行一些操作（如撤回）

//   ,mine: false //是否我发送的消息，如果为true，则会显示在右方

//   ,fromid: "100000" //消息的发送者id（比如群组中的某个消息发送者），可用于自动解决浏览器多窗口时的一些问题

//   ,timestamp: 1467475443306 //服务端时间戳毫秒数。注意：如果你返回的是标准的 unix 时间戳，记得要 *1000

// });

});



layim.on('ready', function(options){


  var socket = new WebSocket('wss://demo.heil.red:8282');

  socket.onmessage = function(e){

      // console.log(e);
      // json数据转换成js对象
      var data = eval("("+e.data+")");

      var type = data.emit || '';

      console.log(data.data);
    //res为接受到的值，如 {"emit": "messageName", "data": {}}

    //emit即为发出的事件名，用于区分不同的消息
      switch(type){

          // Events.php中返回的init类型的消息，将client_id发给后台进行uid绑定
          case 'init':
              // 利用jquery发起ajax请求，将client_id发给后端进行uid绑定
              $.post('/iM/iM/initializeIm', {client_id: data.client_id,access_token: layui.data('layuiAdmin').access_token}, function(data){}, 'json');
              break;

          case 'sendMessage'://发送普通信息

            if(data.data.fromid != options.mine.id){
                layim.getMessage(data.data); //res.data即你发送消息传递的数据
            }
              break;
          case 'addList'://添加好友/群到主面板

              break;

          default :
              // alert(e.data);
      }
  };

});


layim.on('members', function(data){

  console.log(data);

});

});

layui.use('console', layui.factory('console'));

</script>



